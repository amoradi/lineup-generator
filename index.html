<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">

  <title></title>
  
  <link rel="stylesheet" href="css/bootstrap.min.css">
  <link rel="stylesheet" href="css/main.css">
  <script src="scripts/jquery-1.11.3.min.js"></script>

  <!--[if lt IE 9]>
  <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
</head>

<body>
	<div class="container-fluid">
		<div class="title"><div class="row"><h1 class="col-xs-6 col-sm-8 col-md-10">
	<div class="under"><span></span> Under</div> <div class="over"><span></span> Over</div></h1>
			<div class="col-sm-4 col-xs-6 col-md-2 buttons">
				
				<div class="col-xs-12 cart">cart <span>0</span></div>
				<div class="col-xs-12 min">min</div>
				<div class="col-xs-12 max">max</div>
			</div>
		</div></div>
		<div id="lineups"></div>
		<!-- <div class="col-lg-3"></div> -->
	</div>

	<script>

	
	$('.min').on('click', function () {
		var $rows = $("#lineups .row");
		
	    var numericallyOrderedDivs = $rows.sort(function (a, b) {
	        return parseInt($(a).find(".total-price span").text()) - parseInt($(b).find(".total-price span").text());
	    });
	    $("#lineups").html(numericallyOrderedDivs);
	});

	$('.max').on('click', function () {
		var $rows = $("#lineups .row");
		
	    var numericallyOrderedDivs = $rows.sort(function (a, b) {
	        return parseInt($(b).find(".total-price span").text()) - parseInt($(a).find(".total-price span").text());
	    });
	    $("#lineups").html(numericallyOrderedDivs);
	});

	// cart download | Export div contents to txt file
	// http://stackoverflow.com/questions/22084698/how-to-export-source-content-within-div-to-text-html-file
	
	// upload player pool | Upload json file and set as js var (player pool)
	// <input type="file" (type json)
	// set file contents as global js variable PlayerPool
	// http://stackoverflow.com/questions/13515141/html-javascript-how-to-access-json-data-loaded-in-a-script-tag-with-src-set
	// http://www.webcodegeeks.com/html5/html5-file-upload-example/

	// player = {
	//     pos: ,
	//     name: ,
	//     team: ,
	//     price: ,
	//     weight:
	// };

	playerPool = [
		{
		    pos: "QB",
		    name: "player 1",
		    price: 5000,
		    weight: 0
		},
		{
		    pos: "QB",
		    name: "player 2",
		    price: 3000,
		    weight: .70
		}, 
		{
		    pos: "QB",
		    price: 2000,
		    weight: .30
		},
		{
		    pos: "RB",
		    name: "rb1",
		    price: 5000,
		    weight: .5
		},
		{
		    pos: "RB",
		    price: 12000,
		    name: "rb2",
		    weight: .25
		},
		{
		    pos: "RB",
		    name: "rb3",
		    weight: .25
		},
		{
		    pos: "WR",
		    name: "player 4",
		    weight: .333333
		},
		{
		    pos: "WR",
		    name: "player 5",
		    weight: .333333
		},
		{
		    pos: "WR",
		    price: 4500,
		    name: "wr3",
		    weight: .333333
		},
		{
		    pos: "TE",
		    price: 2250,
		    name: "player 6",
		    weight: 1
		},
		{
		    pos: "K",
		    name: "player 7",
		    weight: 1
		},
		{
		    pos: "D",
		    name: "player 8",
		    weight: 1
		}
	];

	var Lineup = {};
	var priceLimit = 20000;

	// INIT
	createLineup([1, 2, 3, 1, 1, 1], 500, playerPool);

	function createLineup(countParams, numLineups, playerPool) {
	    Lineup = setLineupCounts(countParams);

	    for (var i = 0, ii = numLineups; i < ii; i++) {
		    // add players for each position
		    for (pos in Lineup) {
		        addPlayer(pos, Lineup[pos].length, playerPool);
		    }

		    appendToDom(Lineup);
		}

		var tot = $('#lineups .row').length;
		var underLineups = parseInt($('.suitableLineup').length/tot * 100);
		var overLineups = parseInt($('.unsuitableLineup').length/tot * 100);

		$('.over span').text(underLineups+'%');
		$('.under span').text(overLineups+'%');
	}

	function setLineupCounts(countParams) {

	    return lineupCnt = {
	        "QB": new Array(countParams[0]),
	        "RB": new Array(countParams[1]),
	        "WR": new Array(countParams[2]),
	        "TE": new Array(countParams[3]),
	        "K": new Array(countParams[4]),
	        "D": new Array(countParams[5])
	    }
	};

	// add players to lineup{}
	function addPlayer(pos, count, playerPool) {
	    var posArray = [];
	    var posArrayWeights= [];

	    // for each player in pool
	    // if player is position in pos param and is not in lineup already
	    // add to position array
	    playerPool.forEach(function(player, i, arr) {
	        if (player.pos === pos && isNotInArray(player, posArray)) {
	            posArray.push(player);
	        }
	    });

	    // of the position array choose at rondom the needed # for final lineup
	    // var n = 0;
	    Lineup[pos] = [];
	    var aggLastWeight = 0;
	    // poulate weights array
	    for (var i = 0, ii = posArray.length; i < ii; i++) {
	    	var range;
	    	aggLastWeight += posArray[i].weight;

	    	if (i === 0) {
	    		range = [0, aggLastWeight];
	    	} else {
	    		range = [aggLastWeight - posArray[i].weight, aggLastWeight];
	    	}

	    	posArrayWeights.push(range);
	    }

	    // populate final lineup
	    while (Lineup[pos].length < count) {
	    	var randNum = Math.random();

	      	for (var i = 0, ii = posArrayWeights.length; i < ii; i++) {
	    		// randomly select from players if randNum fall within player weight range
	    		if (randNum >= posArrayWeights[i][0] && randNum < posArrayWeights[i][1]) {
	    			// do not duplicate players in lineup
	    			if (isNotInArray(posArray[i], Lineup[pos])) {
	    				Lineup[pos].push(posArray[i]);
	    			}
	    		}
	    	}
	    }
	}

	function isNotInArray(value, array) {
	    return array.indexOf(value) < 0;
	}

	function appendToDom(lineup) {
		var docfrag = document.createDocumentFragment();
		var row = document.createElement("div");
		row.setAttribute('class', 'row');

		function drawMembers(player) {
			var div = document.createElement("div");
			div.setAttribute('class', 'player-template col-xs-4 col-md-1');

			var pos = document.createElement("div");
			pos.setAttribute('class', 'position');
			pos.innerHTML = player.pos;
			div.appendChild(pos);

			var name = document.createElement("div");
			name.setAttribute('class', 'name');
			name.innerHTML = player.name;
 			div.appendChild(name);

 			var team = document.createElement("div");
			team.setAttribute('class', 'team');
			team.innerHTML = player.team;
 			div.appendChild(team);

 			var price = document.createElement("div");
			price.setAttribute('class', 'price');
			price.innerHTML = player.price;
 			div.appendChild(price);

 			var weight = document.createElement("div");
			weight.setAttribute('class', 'weight');
			weight.innerHTML = player.weight;
 			div.appendChild(weight);

 			docfrag.appendChild(div);
		}
		
		function drawPostion(pos) {
			lineup[pos].forEach(function(player, i, arr) {
				drawMembers(player);
			});
		}

		function drawTotalPrice(lineupObj) {
			var totPrice = 0;
			var priceDiv = document.createElement("div");
			priceDiv.setAttribute('class', 'player-template total-price col-xs-4 col-md-1');

			for (pos in lineupObj) {
				for (var i = 0, ii = lineupObj[pos].length; i < ii; i++) {
				
					var price = lineupObj[pos][i]["price"];
					if (typeof price != 'undefined') {
						
						totPrice += price;
					}
				}
			}

			var diff = priceLimit - totPrice;
			var plusOrMinus = (diff >=0 ) ? 'suitableLineup':'unsuitableLineup';


			priceDiv.innerHTML = '<div class="position">$</div><span>' + totPrice + '</span>' + '<div class="'+plusOrMinus+'">'+diff+'</div>';
			docfrag.appendChild(priceDiv);
		}

		function drawAddButton() {
			var addDiv = document.createElement("div");
			addDiv.setAttribute('class', 'addDiv col-xs-8 col-md-2');

			addDiv.innerHTML = '<div class="addButton"><div>Add</div></div>';
			docfrag.appendChild(addDiv);
		}

		drawPostion("QB");
		drawPostion("RB");
		drawPostion("WR");
		drawPostion("TE");
		drawPostion("K");
		drawPostion("D");
		drawTotalPrice(lineup);
		drawAddButton();

		row.appendChild(docfrag);
		document.getElementById('lineups').appendChild(row);
	}
	
	</script>
</body>
</html>

<div class="player-template">
	<div class="position"></div>
	<div class="name"></div>
	<div class="team"></div>
	<div class="price"></div>
	<div class="weight"></div>
</div>