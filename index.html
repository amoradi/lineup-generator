<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">

  <title></title>
  
  <link rel="stylesheet" href="css/bootstrap.min.css">
  <link rel="stylesheet" href="css/main.css">

  <!--[if lt IE 9]>
  <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
</head>

<body>

	<div class="container-fluid">
		<div class="title"><div class="row"><h1 class="col-lg-10">Lineup Generator</h1>
			<div class="col-lg-2 buttons">
				<button class="col-xs-12">cart <span>0</span></button>
				<button class="col-xs-6">min</button>
				<button class="col-xs-6">max</button>
			</div>
		</div></div>
		<div id="lineups" class=""></div>
		<!-- <div class="col-lg-3"></div> -->
	</div>

	<script>
	// player = {
	//     pos: ,
	//     name: ,
	//     team: ,
	//     price: ,
	//     weight:
	// };

	playerPool = [
		{
		    pos: "QB",
		    name: "player 1",
		    price: 5000,
		    weight: 0
		},
		{
		    pos: "QB",
		    name: "player 2",
		    price: 5000,
		    weight: .70
		}, 
		{
		    pos: "QB",
		    price: 5000,
		    weight: .30
		},
		{
		    pos: "RB",
		    name: "rb1",
		    price: 5000,
		    weight: .5
		},
		{
		    pos: "RB",
		    name: "rb2",
		    weight: .25
		},
		{
		    pos: "RB",
		    name: "rb3",
		    weight: .25
		},
		{
		    pos: "WR",
		    name: "player 4",
		    weight: .333333
		},
		{
		    pos: "WR",
		    name: "player 5",
		    weight: .333333
		},
		{
		    pos: "WR",
		    name: "wr3",
		    weight: .333333
		},
		{
		    pos: "TE",
		    name: "player 6",
		    weight: 1
		},
		{
		    pos: "K",
		    name: "player 7",
		    weight: 1
		},
		{
		    pos: "D",
		    name: "player 8",
		    weight: 1
		}
	];

	Lineup = {};

	// INIT
	createLineup([1, 2, 3, 1, 1, 1], 12, playerPool);

	function createLineup(countParams, numLineups, playerPool) {
	    Lineup = setLineupCounts(countParams);

	    for (var i = 0, ii = numLineups; i < ii; i++) {
		    // add players for each position
		    for (pos in Lineup) {
		        addPlayer(pos, Lineup[pos].length, playerPool);
		    }

		    console.log('lineup ready ', Lineup);
		    appendToDom(Lineup);
		}
	}

	function setLineupCounts(countParams) {

	    return lineupCnt = {
	        "QB": new Array(countParams[0]),
	        "RB": new Array(countParams[1]),
	        "WR": new Array(countParams[2]),
	        "TE": new Array(countParams[3]),
	        "K": new Array(countParams[4]),
	        "D": new Array(countParams[5])
	    }
	};

	// add players to lineup{}
	function addPlayer(pos, count, playerPool) {
	    var posArray = [];
	    var posArrayWeights= [];

	    // for each player in pool
	    // if player is position in pos param and is not in lineup already
	    // add to position array
	    playerPool.forEach(function(player, i, arr) {
	        if (player.pos === pos && isNotInArray(player, posArray)) {
	            posArray.push(player);
	        }
	    });

	    // of the position array choose at rondom the needed # for final lineup
	    // var n = 0;
	    Lineup[pos] = [];
	    var aggLastWeight = 0;
	    // poulate weights array
	    for (var i = 0, ii = posArray.length; i < ii; i++) {
	    	var range;
	    	aggLastWeight += posArray[i].weight;

	    	if (i === 0) {
	    		range = [0, aggLastWeight];
	    	} else {
	    		range = [aggLastWeight - posArray[i].weight, aggLastWeight];
	    	}

	    	posArrayWeights.push(range);
	    }

	    console.log('weights', posArrayWeights)

	    // populate final lineup
	    while (Lineup[pos].length < count) {
	    	var randNum = Math.random();

	      	for (var i = 0, ii = posArrayWeights.length; i < ii; i++) {
	    		// randomly select from players if randNum fall within player weight range
	    		if (randNum >= posArrayWeights[i][0] && randNum < posArrayWeights[i][1]) {
	    			// do not duplicate players in lineup
	    			if (isNotInArray(posArray[i], Lineup[pos])) {
	    				console.log('not a duplicate p');
	    				Lineup[pos].push(posArray[i]);
	    			}
	    			console.log('duplicate p');
	    		}
	    	}
	    }

	    // choose random player from pos
	    // add to posArray if not duplicate

	    // if tot lineup price is over
	    // if (is_over && is_over_amount > (p.cost - p.smallest.cost)) {
	    //     removeHigherPlayer();
	    // } else if (posArray.length === count) {
	    //     console.log(pos + ' fulfilled.');
	    //     return;
	    // }

	    //addPlayer(pos, count);

	}

	function isNotInArray(value, array) {
	    return array.indexOf(value) < 0;
	}

	function appendToDom(lineup) {
		var docfrag = document.createDocumentFragment();
		var row = document.createElement("div");
		row.setAttribute('class', 'row');

		function drawMembers(player) {
			var div = document.createElement("div");
			div.setAttribute('class', 'player-template col-lg-1');

			var pos = document.createElement("div");
			pos.setAttribute('class', 'position');
			pos.innerHTML = player.pos;
			div.appendChild(pos);

			var name = document.createElement("div");
			name.setAttribute('class', 'name');
			name.innerHTML = player.name;
 			div.appendChild(name);

 			var team = document.createElement("div");
			team.setAttribute('class', 'team');
			team.innerHTML = player.team;
 			div.appendChild(team);

 			var price = document.createElement("div");
			price.setAttribute('class', 'price');
			price.innerHTML = player.price;
 			div.appendChild(price);

 			var weight = document.createElement("div");
			weight.setAttribute('class', 'weight');
			weight.innerHTML = player.weight;
 			div.appendChild(weight);

 			docfrag.appendChild(div);
		}
		
		function drawPostion(pos) {
			lineup[pos].forEach(function(player, i, arr) {
				drawMembers(player);
			});
		}

		function drawTotalPrice(lineupObj) {
			var totPrice = 0;
			var priceDiv = document.createElement("div");
			priceDiv.setAttribute('class', 'player-template total-price col-lg-1');

			for (pos in lineupObj) {
				for (var i = 0, ii = lineupObj[pos].length; i < ii; i++) {
					console.log('price '+lineupObj[pos][i]["price"]);

					var price = lineupObj[pos][i]["price"];
					if (typeof price != 'undefined') {
						console.log('p ' + price);
						totPrice += price;
					}
				}
			}

			priceDiv.innerHTML = '<div class="position">$</div><span>' + totPrice + '</span>';
			docfrag.appendChild(priceDiv);
		}

		function drawAddButton() {
			var addDiv = document.createElement("div");
			addDiv.setAttribute('class', 'addDiv col-lg-2');

			addDiv.innerHTML = '<div class="addButton"><button>Add</button></div>';
			docfrag.appendChild(addDiv);
		}

		drawPostion("QB");
		drawPostion("RB");
		drawPostion("WR");
		drawPostion("TE");
		drawPostion("K");
		drawPostion("D");
		drawTotalPrice(lineup);
		drawAddButton();

		row.appendChild(docfrag);
		document.getElementById('lineups').appendChild(row);
	}
	
	</script>
</body>
</html>

<div class="player-template">
	<div class="position"></div>
	<div class="name"></div>
	<div class="team"></div>
	<div class="price"></div>
	<div class="weight"></div>
</div>